<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>${systemName}</title>
    <link rel="stylesheet" href="${ctxPath}/assets/common/layui/css/layui.css"/>
    <link rel="stylesheet" href="${ctxPath}/assets/common/module/admin.css?v=311"/>
    <link rel="stylesheet" href="${ctxPath}/assets/expand/css/style.css" media="all"/>

    <style>
        /** 卡片轮播图样式 */
        .admin-carousel .layui-carousel-ind {
            position: absolute;
            top: -41px;
            text-align: right;
        }

        .admin-carousel .layui-carousel-ind ul {
            background: 0 0;
        }

        .admin-carousel .layui-carousel-ind li {
            background-color: #e2e2e2;
        }

        .admin-carousel .layui-carousel-ind li.layui-this {
            background-color: #999;
        }

        /** 广告位轮播图 */
        .admin-news .layui-carousel-ind {
            height: 45px;
        }

        .admin-news a {
            display: block;
            line-height: 60px;
            text-align: center;
        }

    </style>
</head>

<body>

<!-- 正文开始 -->
<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-xs12 layui-col-sm6 layui-col-md3">
            <div class="layui-card">
                <div class="layui-card-header">
                    访问量<span class="layui-badge layui-bg-black pull-right">日</span>
                </div>
                <div class="layui-card-body">
                    <p class="lay-big-font">12,500</p>
                    <p>总访问量<span class="pull-right">32万+ <i class="layui-icon layui-icon-flag"></i></span></p>
                </div>
            </div>
        </div>
        <div class="layui-col-xs12 layui-col-sm6 layui-col-md3">
            <div class="layui-card">
                <div class="layui-card-header">
                    今日注册量<span class="layui-badge layui-bg-black pull-right">日</span>
                </div>
                <div class="layui-card-body">
                    <p class="lay-big-font">${clientUserToDayCount}</p>
                    <p>总注册量<span class="pull-right">${clientUserCount} <i class="layui-icon"></i></span></p>
                </div>
            </div>
        </div>
        <div class="layui-col-xs12 layui-col-sm6 layui-col-md3">
            <div class="layui-card">
                <div class="layui-card-header">
                    今日认证量<span class="layui-badge layui-bg-black pull-right">日</span>
                </div>
                <div class="layui-card-body">
                    <p class="lay-big-font" id="portCallNum">${portNum.portCallNum}</p>
                    <p>认证总量<span class="pull-right" id="portCallCount">${portNum.portCallCount} 次<i
                            class="layui-icon layui-icon-notice"></i></span></p>
                </div>
            </div>
        </div>
        <div class="layui-col-xs12 layui-col-sm6 layui-col-md3">
            <div class="layui-card">
                <div class="layui-card-header">
                    今日短信量<span class="layui-badge layui-bg-black pull-right">日</span>
                </div>
                <div class="layui-card-body">
                    <p class="lay-big-font" id="portPrice">${smsPortNum.smsPortCallNum}</p>
                    <p>短信总量
                        <span class="pull-right" id="portPriceCount">${smsPortNum.smsPortCallCount} 次<i
                                class="layui-icon layui-icon-notice"></i>
                            <!--                        <i class="layui-icon "></i>-->
                    </span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="layui-row layui-col-space15">
        <div class="layui-col-xs12">
            <div class="layui-card">
                <div class="layui-card-body">
                    <div class="layui-tab layui-tab-brief" lay-filter="tabZZT">
                        <ul class="layui-tab-title">
                            <li class="layui-this">下款总额</li>
                            <!--                            <li>下款额度</li>-->
                        </ul>
                        <div class="layui-tab-content">
                            <div class="layui-tab-item layui-show">
                                <div class="layui-row layui-col-space30">
                                    <div class="layui-col-xs12 layui-col-md8">
                                        <div id="loanAmount" style="height: 300px;margin-top: 20px;"></div>
                                    </div>
                                    <div class="layui-col-xs12 layui-col-md4">
                                        <table class="layui-table" lay-skin="nob">
                                            <colgroup>
                                                <col width="50">
                                                <col width="150">
                                                <col width="150">
                                                <col width="100">
                                                <col width="100">
                                            </colgroup>
                                            <thead>
                                            <tr style="background: none;color: #333;">
                                                <th colspan="4">门店排名 Top<span class="layui-badge layui-bg-black pull-right">日</span></th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            @for(data in everyDayData){
                                                <tr>
                                                    <td>
                                                        @if(dataLP.index < 3){
                                                            <span class="layui-badge layui-bg-cyan">${dataLP.index}</span>
                                                        @}else{
                                                            <span class="layui-badge layui-bg-gray">${dataLP.index}</span>
                                                        @}
                                                    </td>
                                                    <td>${data.simpleName}</td>
                                                    <td>${data.contractAmount}</td>
                                                    <td>${data.blanketOrder}</td>
                                                    <td>${data.loanRatio}%</td>
                                                </tr>
                                            @}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="layui-col-lg8 layui-col-md7">
            <div class="layui-card">
                <div class="layui-card-header">认证接口柱状图</div>
                <div class="layui-card-body">
                    <div class="layui-tab layui-tab-brief" lay-filter="tabZZT">
                        <ul class="layui-tab-title">
                            <li class="layui-this">认证总量趋势图</li>
                            <li>认证总价趋势图</li>
                        </ul>
                        <div class="layui-tab-content">
                            <div class="layui-tab-item layui-show">
                                <div class="layui-row layui-col-space30">
                                    <div class="layui-col-xs12 layui-col-md12">
                                        <div id="xse" style="height: 300px;margin-top: 20px;"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="layui-tab-item">
                                <div class="layui-row layui-col-space30">
                                    <div class="layui-col-xs12 layui-col-md12">
                                        <div id="fwl" style="height: 300px;margin-top: 20px;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-card">
                <div class="layui-card-header">短信接口柱状图</div>
                <div class="layui-card-body">
                    <div class="layui-tab layui-tab-brief" lay-filter="tabZZY">
                        <ul class="layui-tab-title">
                            <li class="layui-this">短信总量趋势图</li>
                            <li>短信总价趋势图</li>
                        </ul>
                        <div class="layui-tab-content">
                            <div class="layui-tab-item layui-show">
                                <div class="layui-row layui-col-space30">
                                    <div class="layui-col-xs12 layui-col-md12">
                                        <div id="ecPortNumber" style="height: 300px;margin-top: 20px;"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="layui-tab-item">
                                <div class="layui-row layui-col-space30">
                                    <div class="layui-col-xs12 layui-col-md12">
                                        <div id="ecPportPrice" style="height: 300px;margin-top: 20px;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-col-lg4 layui-col-md5">
            <div class="layui-card">
                <div class="layui-card-header">项目介绍</div>
                <div class="layui-card-body">
                    <table class="layui-table layui-text">
                        <colgroup>
                            <col width="100">
                            <col>
                        </colgroup>
                        <tbody>
                        <tr>
                            <td>项目名称</td>
                            <td>${systemName}</td>
                        </tr>
                        <tr>
                            <td>开源版本</td>
                            <td>${systemName} 基础版 v1.0</td>
                        </tr>
                        <tr>
                            <td>vip版本</td>
                            <td>VIP v1.0</td>
                        </tr>
                        <tr>
                            <td>官方地址</td>
                            <td><a href="https://www.baidu.com" target="_blank">https://www.baidu.com</a></td>
                        </tr>
                        <tr>
                            <td>gitee地址</td>
                            <td><a href="" target="_blank"></a></td>
                        </tr>
                        <tr>
                            <td>主要特色</td>
                            <td>开源 / 简洁 / 功能丰富 / 易上手 / 文档丰富 / 社区活跃</td>
                        </tr>
                        <tr>
                            <td>推广注册</td>
                            <td>
                                <a href="javascript:void(0)"
                                   class="layui-btn layui-btn-sm" id="promoteLinks">推广链接</a>
                                <a href="javascript:void(0)"
                                   class="layui-btn layui-btn-danger layui-btn-sm" id="createQrCode">二维码</a>
                            </td>
                        </tr>
                        <tr>
                            <td>获取文档</td>
                            <td>
                                <a href="#"
                                   target="_blank" class="layui-btn layui-btn-sm">免费文档</a>
                                <a href="" target="_blank"
                                   class="layui-btn layui-btn-danger layui-btn-sm">新颜接口测试</a>
                            </td>
                        </tr>
                        <tr>
                            <td>获取视频教程</td>
                            <td>
                                <a href="#"
                                   target="_blank" class="layui-btn layui-btn-sm">免费视频</a>
                                <a href="#" target="_blank"
                                   class="layui-btn layui-btn-danger layui-btn-sm">付费视频(更全)</a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!--            <div class="layui-card">-->
            <!--                <div class="layui-card-header">前端框架</div>-->
            <!--                <div class="layui-card-body">-->
            <!--                    <table class="layui-table layui-text">-->
            <!--                        <colgroup>-->
            <!--                            <col width="100">-->
            <!--                            <col>-->
            <!--                        </colgroup>-->
            <!--                        <tbody>-->
            <!--                        <tr>-->
            <!--                            <td>基础框架</td>-->
            <!--                            <td><a href="https://www.layui.com/" target="_blank">layui v2.4.5</a></td>-->
            <!--                        </tr>-->
            <!--                        <tr>-->
            <!--                            <td>基础框架</td>-->
            <!--                            <td><a href="https://easyweb.vip/" target="_blank">easyweb v3.1.1</a></td>-->
            <!--                        </tr>-->
            <!--                        <tr>-->
            <!--                            <td>树形框架</td>-->
            <!--                            <td><a href="http://www.treejs.cn/v3/main.php#_zTreeInfo" target="_blank">zTree v3.5.28</a>-->
            <!--                            </td>-->
            <!--                        </tr>-->
            <!--                        <tr>-->
            <!--                            <td>其他框架</td>-->
            <!--                            <td>jQuery、layui周边框架</td>-->
            <!--                        </tr>-->
            <!--                        <tr>-->
            <!--                            <td>主要特色</td>-->
            <!--                            <td>易上手 / 简约 / 依赖少</td>-->
            <!--                        </tr>-->
            <!--                        </tbody>-->
            <!--                    </table>-->
            <!--                </div>-->
            <!--            </div>-->

            <!--            <div class="layui-card">-->
            <!--                <div class="layui-card-header">后台框架</div>-->
            <!--                <div class="layui-card-body">-->
            <!--                    <table class="layui-table layui-text">-->
            <!--                        <colgroup>-->
            <!--                            <col width="100">-->
            <!--                            <col>-->
            <!--                        </colgroup>-->
            <!--                        <tbody>-->
            <!--                        <tr>-->
            <!--                            <td>核心框架</td>-->
            <!--                            <td>Spring Boot</td>-->
            <!--                        </tr>-->
            <!--                        <tr>-->
            <!--                            <td>视图渲染</td>-->
            <!--                            <td>Spring MVC、<a href="http://ibeetl.com" target="_blank">Beetl</a></td>-->
            <!--                        </tr>-->
            <!--                        <tr>-->
            <!--                            <td>持久层</td>-->
            <!--                            <td>MyBatis、Druid、<a href="http://mp.baomidou.com" target="_blank">MyBatis-Plus</a>-->
            <!--                            </td>-->
            <!--                        </tr>-->
            <!--                        <tr>-->
            <!--                            <td>权限框架</td>-->
            <!--                            <td>Shiro、JWT(API接口权限)-->
            <!--                            </td>-->
            <!--                        </tr>-->
            <!--                        <tr>-->
            <!--                            <td>数据库</td>-->
            <!--                            <td>支持Mysql、Oracle、Postgre SQL、Sql Server</td>-->
            <!--                        </tr>-->
            <!--                        <tr>-->
            <!--                            <td>其他</td>-->
            <!--                            <td>代码生成器</td>-->
            <!--                        </tr>-->
            <!--                        </tbody>-->
            <!--                    </table>-->
            <!--                </div>-->
            <!--            </div>-->

            <div class="layui-card">
                <div class="layui-card-header">开源荣誉</div>
                <div class="layui-card-body">
                    <div class="layui-carousel admin-carousel admin-news">
                        <div carousel-item>
                            <div>
                                <a href="#" target="_blank"
                                   class="layui-bg-green">
                                    鑫炜科技
                                </a>
                            </div>
                            <div>
                                <a href="#" target="_blank" class="layui-bg-cyan">
                                    鑫炜科技
                                </a>
                            </div>
                            <div>
                                <a href="#" target="_blank"
                                   class="layui-bg-blue">
                                    鑫炜科技
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- js部分 -->
@/* 加入contextPath属性和session超时的配置 */
<script type="text/javascript">
    var Feng = {
        ctxPath: "",
        addCtx: function (ctx) {
            if (this.ctxPath === "") {
                this.ctxPath = ctx;
            }
        }
    };
    Feng.addCtx("${ctxPath}");
</script>

<script type="text/javascript" src="${ctxPath}/assets/common/layui/layui.js"></script>
<script type="text/javascript" src="${ctxPath}/assets/common/js/common.js?v=311"></script>
<script src="${ctxPath}/assets/common/libs/echarts/echarts.min.js"></script>
<script src="${ctxPath}/assets/common/libs/echarts/echartsTheme.js"></script>
<script src="https://cdn.bootcss.com/clipboard.js/1.7.1/clipboard.min.js"></script>

<script>
    // 方法一
    function toThousands(num) {
        var result = [], counter = 0;
        num = (num || 0).toString().split('');
        for (var i = num.length - 1; i >= 0; i--) {
            counter++;
            result.unshift(num[i]);
            if (!(counter % 3) && i !== 0) {
                result.unshift(',');
            }
        }
        return result.join('');
    }


    layui.use(['layer', 'carousel', 'ax', 'element'], function () {
        var $ = layui.jquery;
        var layer = layui.layer;
        var carousel = layui.carousel;
        var $ax = layui.ax;
        var device = layui.device;
        var element = layui.element;

        // 渲染轮播
        carousel.render({
            elem: '.layui-carousel',
            width: '100%',
            height: '60px',
            arrow: 'none',
            autoplay: true,
            trigger: device.ios || device.android ? 'click' : 'hover',
            anim: 'fade'
        });

        // 切换选项卡重新渲染
        element.on('tab(tabZZT)', function (data) {
            if (data.index === 0) {
                myCharts.resize();
            } else {
                myCharts2.resize();
            }
        });

        // 切换选项卡重新渲染
        element.on('tab(tabZZY)', function (data) {
            if (data.index === 0) {
                myCharts3.resize();
            } else {
                myCharts4.resize();
            }
        });

        var getDay = function (data) {
            var day = [];
            $.each(data, function (i, o) {
                day.push(o + "日");
            });
            return day;
        };

        var getData = function (data) {
            var dat = [];
            $.each(data, function (i, o) {
                dat.push(o);
            });
            return dat;
        };

        var getPrice = function (data) {
            var price = [];
            $.each(data, function (i, o) {
                price.push(o.toFixed(2));
            });
            return price;
        };

        /**
         * 合同金额
         */
        var getEveryMonthContractAmount = function (data) {

        };

        /**
         * 实际放款金额
         */
        var getEveryMonthLoanAmount = function (data) {
            var loanAmount = [];
            loanAmount.push(data.m1_loan_amount);
            loanAmount.push(data.m2_loan_amount);
            loanAmount.push(data.m3_loan_amount);
            loanAmount.push(data.m4_loan_amount);
            loanAmount.push(data.m5_loan_amount);
            loanAmount.push(data.m6_loan_amount);
            loanAmount.push(data.m7_loan_amount);
            loanAmount.push(data.m8_loan_amount);
            loanAmount.push(data.m9_loan_amount);
            loanAmount.push(data.m10_loan_amount);
            loanAmount.push(data.m11_loan_amount);
            loanAmount.push(data.m12_loan_amount);
            return loanAmount;
        };

        /**
         * 渲染接口调用量表格
         */
        var myCharts = echarts.init(document.getElementById('xse'), myEchartsTheme);
        var option = {
            title: {
                text: '近7天趋势',
                textStyle: {
                    color: '#000',
                    fontSize: 14
                }
            },
            tooltip: {},
            grid: {
                left: '0',
                right: '0',
                bottom: '0',
                containLabel: true
            },
            xAxis: {
                data: getDay(${portChart.day})
            },
            yAxis: {},
            series: [{
                type: 'bar',
                data: getData(${portChart.data}),
                barMaxWidth: 45
            }]
        };
        myCharts.setOption(option);

        /**
         * 渲染接口调用总价表格
         */
        var myCharts2 = echarts.init(document.getElementById('fwl'), myEchartsTheme);
        var option2 = {
            title: {
                text: '近7天趋势',
                textStyle: {
                    color: '#000',
                    fontSize: 14
                }
            },
            tooltip: {},
            grid: {
                left: '0',
                right: '0',
                bottom: '0',
                containLabel: true
            },
            xAxis: {
                data: getDay(${portChart.day})
            },
            yAxis: {},
            series: [{
                type: 'bar',
                data: getPrice(${portChart.price}),
                barMaxWidth: 45
            }]
        };
        myCharts2.setOption(option2);

        /**
         * 渲染短信接口调用总量表格
         */
        var myCharts3 = echarts.init(document.getElementById('ecPortNumber'), myEchartsTheme);
        var option3 = {
            title: {
                text: '近7天趋势',
                textStyle: {
                    color: '#000',
                    fontSize: 14
                }
            },
            tooltip: {},
            grid: {
                left: '0',
                right: '0',
                bottom: '0',
                containLabel: true
            },
            xAxis: {
                data: getDay(${smsPortChart.day})
            },
            yAxis: {},
            series: [{
                type: 'bar',
                data: getData(${smsPortChart.data}),
                barMaxWidth: 45
            }]
        };
        myCharts3.setOption(option3);

        /**
         * 渲染短信接口调用总价表格
         */
        var myCharts4 = echarts.init(document.getElementById('ecPportPrice'), myEchartsTheme);
        var option4 = {
            title: {
                text: '近7天趋势',
                textStyle: {
                    color: '#000',
                    fontSize: 14
                }
            },
            tooltip: {},
            grid: {
                left: '0',
                right: '0',
                bottom: '0',
                containLabel: true
            },
            xAxis: {
                data: getDay(${smsPortChart.day})
            },
            yAxis: {},
            series: [{
                type: 'bar',
                data: getPrice(${smsPortChart.price}),
                barMaxWidth: 45
            }]
        };
        myCharts4.setOption(option4);


        // 渲染放款总额
        var myCharts5 = echarts.init(document.getElementById('loanAmount'), myEchartsTheme);
        var option5 = {
            title: {
                text: '下款总额',
                textStyle: {
                    color: '#000',
                    fontSize: 14
                }
            },
            tooltip: {},
            grid: {
                left: '0',
                right: '0',
                bottom: '0',
                containLabel: true
            },
            xAxis: {
                data: ['1月', '2月', '3月', '4月', '6月', '6月', '7月', '8月', '9月', '10月', '11月', '12月']
            },
            yAxis: {},
            series: [{
                type: 'bar',
                data: getEveryMonthLoanAmount(${everyMonthData}),
                barMaxWidth: 45
            }]
        };
        myCharts5.setOption(option5);

        /**
         * 获取推广连接
         *
         */
        var getPromoteLinksUrl = function () {
            var re = null;
            var ajax = new $ax(Feng.ctxPath + "/h5/promoteLinks", function (result) {
                re = result;
            });
            ajax.start();
            return re;
        };

        /**
         * 绑定推广连接点击事件
         */
        $("#promoteLinks").click(function () {
            var result = getPromoteLinksUrl();
            var content = result.data;
            // 使用textarea支持换行，使用input不支持换行
            var textarea = document.createElement('textarea');
            textarea.value = content;
            document.body.appendChild(textarea);
            textarea.select();
            if (document.execCommand('copy')) {
                document.execCommand('copy');
                layer.msg("复制成功");
            }
            document.body.removeChild(textarea)
        });

        // 绑定生成二维码事件
        $("#createQrCode").click(function () {
            var result = getPromoteLinksUrl();
            window.open("https://cli.im/api/qrcode/code?text=" + result.message);
        });
    });
</script>
</body>

</html>